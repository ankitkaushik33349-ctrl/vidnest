<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Player</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      background: #000;
    }
    iframe {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      border: 0;
    }
  </style>
</head>
<body>
  <iframe
    id="player"
    frameborder="0"
    allowfullscreen
    sandbox="allow-scripts allow-same-origin"
  ></iframe>

  <script>
    const iframe = document.getElementById('player');
    const base = 'https://vidnest.fun';
    const params = new URLSearchParams(window.location.search);

    const type = params.get('type');
    const id = params.get('id');
    const season = params.get('season');
    const episode = params.get('episode');
    const startat = params.get('progress');
    const prevepisode = params.get('prevepisode');
    const nextepisode = params.get('nextepisode');

    const fixed = new URLSearchParams({
      theme: '#e64460',
      sub: 'en',
      autoplay: 'true',
      nextbutton: 'false',
      prevepisode: 'false',
    });
    if (startat) fixed.set('progress', startat);

    let url = '';
    if (type === 'movie') {
      url = `${base}/movie/${id}?${fixed.toString()}`;
    } else if (type === 'tv') {
      url = `${base}/tv/${id}/${season}/${episode}?${fixed.toString()}`;
    } else {
      url = `${base}?${fixed.toString()}`;
    }

    iframe.src = url;

    // --- Popup blocking ---
    const blockPopups = () => {
      try {
        const win = iframe.contentWindow;
        if (win) {
          win.open = () => null;
          win.alert = () => null;
          win.confirm = () => null;
        }
      } catch (e) {}
    };
    iframe.addEventListener('load', blockPopups);
    window.open = () => null;

    // --- Forward vidnest messages to the parent site ---
    window.addEventListener('message', (event) => {
      if (!event.origin.includes('vidnest.fun')) return;
      if (window.parent !== window) {
        window.parent.postMessage(event.data, '*');
      }
    });
  </script>
</body>
</html>
